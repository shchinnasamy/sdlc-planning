name: Planning Agent Trigger
on:
  issues:
    types: [labeled]
jobs:
  dispatch-agent:
    if: github.event.label.name == 'product-feedback'
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Logic App
        env:
          ISSUE_TITLE: ${{ github.event.issue.title }}
          ISSUE_BODY: ${{ github.event.issue.body }}
          ISSUE_URL: ${{ github.event.issue.html_url }}
        run: |
          jq -n \
            --arg title "$ISSUE_TITLE" \
            --arg body "$ISSUE_BODY" \
            --arg url "$ISSUE_URL" \
            '{title: $title, body: $body, url: $url}' | \
          curl -X POST "${{ secrets.LOGIC_APP_URL }}" \
            -H "Content-Type: application/json" \
            -d @-